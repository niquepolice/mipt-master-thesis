\section{Распределённые системы управления}

https://ieeexplore.ieee.org/abstract/document/8585956 --про суперконденсаторы.
 Секция 3 --- обзор алгоритмов частотного разделения лития и суперкапов, мультиагентные системы

\url{https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=4497237&tag=1}
Distributed MPC Strategies With Application to Power System Automatic Generation ControlAswin N. Venkat,  Ian A. Hiskens, 
--- Communication-Based MPC $\rightarrow$ равновесие Нэша.\\
Feasible Cooperation-Based MPC

\url{https://www.youtube.com/watch?v=e_DlQhe3yiI}
--- распределённая стохастическая оптимизация на сетях.
Выбор случайных соседей (входная степень не больше Q) чтобы уменьшить количество рёбер в подграфе передачи данных 17минута (исходный граф может быть полным), gossip как аналог случаю при Q=1

\url{https://ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber=9198090} Simultaneous Perturbation Stochastic Approximation-based Consensus for Tracking under Unknown–but–Bounded Disturbances Oleg Granichin,Senior Member, IEEE,Victoria Erofeeva, Yury Ivanskiy,and Yuming Jiang,Senior Member, IEEE --- ссылки в интро на историческую литературу про распределённую оптимизацию, consensus, gossip, что-то про невыпуклый случай

Мотивация к применению распределённых систем управления следующая:

\begin{itemize}
% \item
% Низкая инерция современных энергосистем требует высокой скорости реакции системы управления.
% Хотя это требование больше относится к первичному и вторичному регулированию

\item
При большом количестве устройств централизованное управление приводит к большим потокам данных через управляющий узел, что приводит к высоким (и растущим по мере подключения новых устройств) требованиям к сетевой инфраструктуре.
В модели распределённого управления агенты обмениваются информацией только с соседями по графу коммуникаций.
Отсутствие выделенного центрального узла позволяет избежать возникновения узкого места по мере расширения сети.
По литературе (\cite{binetti2014distributed} $\rightarrow$ \cite{elsayed2014fully}) также кочует мнение, что децентрализованные системы гибче по отношению к изменениям в сетевой топологии, поэтому лучше приспособлены к поддержке технологии plug-and-play.

\item
В распределённых системах управления сложность решения оптимизационной задачи делится между агентами, что может увеличить скорость вычислений для больших систем.

\item
Распределённое управление существенно надёжнее, так как не подвержено риску коллапса управляемой системы при отказе одного вычислительного узла.

\item
Распределённый подход позволяет не предоставлять центральному узлу информацию о своих измерениях, функциях стоимости и ограничениях, что обеспечивает приватность данных.
Также считается \cite{loia2013decentralized,molzahn2017survey} что распределённые системы надёжнее в плане кибербезопасности.

\item
Централизованный подход требует качественной модели системы (которая для большой системы становится слишком сложной), ошибки в модели приводят к плохому управлению \cite{binetti2014distributed}.


\end{itemize}
% В обзоре \cite{olivares2014trends} дана хорошая картинка разнообразия систем управления и их классификация, как по уровню в иерархии, так и по степени централизованности. 


Ниже дан обзор современных исследований в группе распределённых систем управления на уровне решения задач economic dispatch / optimal power flow. 
Эти два термина соответствуют двум близким постановкам задач. 
Первый обычно применяется для более идеализированной модели баланса активной мощности без потерь в линиях, второй --- когда учитываются импедансы линий и, соответственно, разница между амплитудами и/или фазами напряжений на шинах. 
\begin{itemize}
\item Распределённые алгоритмы численной оптимизации:
\begin{itemize}
% \item \cite{elsayed2014fully} --- распределённая оптимизация с невыпуклыми функциями стоимости. Цитирует
\item \cite{loia2013decentralized} --- в статье дано подробное иллюстративное описание централизованного подхода на методе Лагранжа. 
Предложен децентрализованный абсолютно симметричный подход к поиску решения задачи минимизации.
В основе метода лежит постановка задачи \textit{$\gamma$-consensus problem} : у каждого агента есть (начальное) значение $x_i$ некоторой величины, задача ---  сделать так, чтобы все агенты получили (одно и то же) значение $\gamma(x)$, где $\gamma :\R^n \rightarrow \R$ , не собирая при этом всю информацию у специального центрального агента, а допуская только симметричный обмен данными и только между соседями в \textit{графе коммуникаций} (каналов передачи информации).
Конкретнее, в статье в качестве $\gamma$ используются функции среднего и взвешенного среднего (\textit{average consensus}).
Решение такой задачи --- итерационный алгоритм, на каждой итерации которого агенты обмениваются со своими соседями текущим значением величины и корректируют своё значение на основе значений соседей (для функций среднего сближают своё значение со средним по соседям).
Утверждается [cortes, проверить], что при правильном выборе способа корректировки значения $x_i$ у каждого агента сходятся к искомому значению функции $\gamma(x)$.

В статье показано, что нахождения взвешенного среднего достаточно для децентрализованного решения задачи оптимального распределения нагрузки (с ограничением типа равенство на баланс мощности) с \textbf{выпуклыми} функциями стоимости, упрощённым учётом потерь в линиях и учётом ограничений на мощности генераторов (ограничения типа неравенства) с помощью минимизации функции Лагранжа, остальные операции производятся локально с привлечением только локальной информации.
При этом никто никому не сообщает коэффициенты своей функции стоимости, только ищется консенсус для определения общих переменных (типа поправки для множителя Лагранжа или суммарной нагрузки).

Основная идея в том, что у каждого генератора функция стоимости зависит только от своей управляющей переменной и не зависит от управляющих переменных других генераторов.
Поэтому при применении градиентного спуска для поиска минимума функции Лагранжа каждый агент может рассчитывать шаг для своей управляющей переменной практически самостоятельно, зная только свою функцию стоимости и текущее значение двойственной переменной, соответствующей ограничению на баланс мощности:
\begin{equation}
\begin{split}
    L &= \sum_i c_i(p_i) + \lambda \left(p_D - \sum_i p_i \right),\\
    \nabla{L} &= 
    \left(
        {c'_1}(p_1) - \lambda,~
        \ldots,~ 
        c'_n(p_n) - \lambda,~
        p_D - \sum_i p_i 
    \right)^T,\\
\end{split}
\end{equation}

где $P_D$ --- power demand, мощность нагрузки. 

Остаётся только с помощью average consensus найти шаг для множителя Лагранжа. 
В статье этот подход применяется при более общих условиях (с учётом потерь в линиях и ограничений на мощности генераторов) и для метода Ньютона вместо градиентного спуска, чтобы уменьшить число итераций поиска, на каждой из которых нужно решать задачу поиска консенсуса (что, по данным авторов, требует около 100 итераций для системы с 3-мя генераторами и около 400 для порядка 60-ти генераторов).

\medskip

Поскольку в нашей системе изначально присутствуют элементы централизации на уровне сетевой архитектуры (mqtt-брокер --- своего рода \textit{fusion center}), и поскольку mqtt спроектирован не для end-to-end обмена сообщениями, а для широковещательного распространения информации в топиках, мы можем заменить алгоритм нахождения консенсуса на явное неитеративное распространение информации о начальных значениях $x_i$ и получение искомого значения $\gamma(x)$ прямым способом локально каждым агентом.

Недостаток подхода --- предположение о выпуклости функций стоимости, в то время как для нас представляют интерес кусочно-непрерывные зависимости, дискретность в которых связана с затратами на подготовку к работе и затратами на работу на холостом ходу. 
Впрочем, при небольшом числе бинарных переменных (< 5-10) нет особых проблем решить выпуклую задачу для каждой комбинации их значений.

\item
В \cite{molzahn2017survey} в более общем виде дан обзор математических методов 
(Dual Decomposition,
the Alternating Direction Method of Multipliers + Proximal Message Passing (аналог average consensus), Analytical Target Cascading, the Auxiliary Problem Principle, Optimality
Condition Decomposition, Consensus+Innovation),
аналогичных \cite{loia2013decentralized}, и их применения для решения optimal power flow в разных приближениях.
Кроме того, там обсуждаются онлайн-алгоритмы и задачи optimal power flow, optimal 

\item 
% цитировалась ли в loia или fully ?
В \cite{lin2008distributed} предлагается распределённый субоптимальный алгоритм решения optimal power flow \textbf{с дискретными переменными}.
Применяются методы ordinal optimization, дискретная задача решается с помощью решения непрерывных задач, для чего предложен распределённый алгоритм, кажется, похожий на алгоритм из \cite{loia2013decentralized}.

\end{itemize}

\item Аукционный подход

Механизм ставок и поиска равновесной цены отлично решает проблемы изолирования конфиденциальной информации и независимости от модели, но в классическом виде не является полностью децентрализованным, т.к. выделяется агент-аукционер, вычисляющий равновесную цену.
Более значимо, что уровень абстракции аукционной системы не позволяет
% пруфы???
% вообще повыяснять про эквивалентность аукционного или игрового подхода и прямого оптимизационного
% в статье breaking the hierarchy была какая-то эквивалентность минимазаторов задачи оптимизации и 
% аттрактора лруп контроля что-ли, но там вроде для каждого решения нужно подбирать свои коэффициенты
% статизма, что тогда делает утверждление вроде тривиальным, хз
получить оптимальное решение или учесть технические ограничения, заложенные в задачи optimal power flow.
Поэтому аукционный подход неактуален для закрытой изолированной системы.

Больше информации можно получить, например, из обзора \cite{olivares2014trends}, где дана своего рода картинка разнообразия систем управления и их классификация, как по уровню в иерархии управления, так и по степени централизованности, или из ранней, наиболее популярной статьи по теме мультиагентного подхода в микрогридах \cite{dimeas2005operation}.


\item Теоретико-игровой подход: дизайн механизмов, равновесие Нэша

В открытых конкурентных системах эгоистично-оптимальное поведение может привести (равновесие Нэша) к неоптимальному для всех режиму (см, например, пародоксы Браеса и Бертрана).
Поэтому возникает потребность в применении теории игр для разработки правил рынка, позволяющих оптимально работать по механизму ``think locally, act globally'', то есть получить механизм, в котором равновесие Нэша является оптимальным, что эквивалентно распределённой оптимизации \cite{li2013designing}.
Поскольку в нашей системе все устройства принадлежат одному владельцу, исследование этих вопросов неактульно.



    % communication bottlenecks;
    % complex control and optimization problems;
    % growing of energy management systems complexity;
    % centralized infrastructures can be a security target.
    
    % We expect that this bio-inspired solution strategy ex-
    % hibits several advantages over traditional client server-based
    % paradigms as far as less network bandwidth, less computation
    % time, easy to extend and reconfigure are concerned.
    
    
    
    % Recent studies directed at enabling smart grids have led to a new
    % research trend: the development and investigation of solutions
    % to the EDP based on decentralized and distributed mechanisms
    % [1]–[5]. The primary motivations for this trend are as follows:
    % 1) The extensive employment of smart grid concepts will lead
    % to communication congestion and complexity in central
    % management systems. The complexity inherent in central-
    % ized controllers may make it difficult for system operators
    % to act on information collected from smart grid sensors
    % in an appropriate time frame [1], and the resultant com-
    % munication congestion requires the implementation of a
    % high-bandwidth communication infrastructure [5].
    % 2) A fully decentralized system does not give rise to con-
    % cerns about reliability issues related to single point failure
    % [1]–[5].
    % 3) Distributed and decentralized systems are more scalable
    % and more flexible with respect to system changes than cen-
    % tralized systems and hence can more effectively accommo-
    % date the variable topology and the plug-and-play feature
    % associated with smart grids [4].
        
    % [4] A centralized
    % controller usually requires high bandwidth communication
    % infrastructure to act on system-wide gathered information,
    % needs a high-level of connectivity, poses reliability concerns
    % due to the presence of a single point-of-failure, and is prone to
    % modeling error. Moreover, both the future power grid and the
    % communication network are likely to have a variable topology,
    % which undermines the efficacy of a centralized mechanism.
    % Alternatively, distributed algorithms can be more suitable to
    % handle topological variations and accommodate plug-and-play
    % features. Moreover, they are more robust, scalable, and can
    % better accommodate a large number of units compared to cen-
    % tralized approaches. Finally, a distributed decision-making tool
    % can effectively utilize sparse communication infrastructures
    % with limited message passing among participating units.
    
    
    % Distributed algorithms have several potential advantages
    % over centralized approaches. The computing agents only have
    % to share limited amounts of information with a subset of
    % the other agents. This can improve cybersecurity and reduce
    % the expense of the necessary communication infrastructure.
    % Distributed algorithms also have advantages in robustness with
    % respect to failure of individual agents. Further, with the abil-
    % ity to perform parallel computations, distributed algorithms
    % have the potential to be computationally superior to centralized
    % algorithms, both in terms of solution speed and the maxi-
    % mum problem size that can be addressed. Finally, distributed
    % algorithms also have the potential to respect privacy of data,
    % measurements, cost functions, and constraints, which becomes
    % increasingly important in a distributed generation scenario.
\end{itemize}

Теперь вспомним ``мотивационный список''.

В нашем проекте небольшое количество устройств и все они принадлежат одному владельцу, поэтому соображения о приватности и больших размерах управляемой системы, как и, вероятно, о изменяемой топологии, неактуальны.
Главным преимуществом становится устойчивость к потере одного агента.
В нашей агентной системе это свойство можно сохранить и при централизованном управлении, если при потере управляющего узла передавать его роль другому агенту (если любой агент из кластера может переключиться в режим управляющего центра, но одновременно в этом режиме работает только один агент).

Другой простой способ ``децентрализоваться'' --- позволить всем агентам делиться информацией о своём состоянии (заряд батареи, готовность к выходу на рабочий режим / ограничения на потоки мощности, текущие коэффициенты функции стоимости) со всеми и каждому агенту решать общую оптимизационную задачу самостоятельно.
Тогда все будут локально получать одинаковые решения без передачи оптимальных значений управляющих переменных от управляющего центра к агентам.
Такой подход рассматривается в \cite{elsayed2014fully}, где алгоритм поиска консенсуса \textit{flooding-based consensus algorithm} применяется для децентрализованного распространения исходных данных для решения задачи, затем каждый агент локально решает оптимизационную задачу.
Пользу от децентрализации авторы извлекают в виде возможности более эффективно решать невыпуклые задачи (в статье предлагается учесть \textit{valve-point effect}, который приводит к добавлению к выпуклой функции стоимости модуля синуса. Графики, алгоритмы оптимизации см в \cite{sharma2017solution}).
А именно, каждый агент начинает поиск из случайной точки и сходится к локальному минимуму, удовлетворяющему ограничениям.
Эта процедура может локально повторяться несколько раз.
После этого алгоритм нахождения консенсуса применяется для того, чтобы выбрать лучшее (из лучших, если было несколько локальных итераций) решение среди всех агентов.

Коэффициенты функций стоимости и ограничения режима работы (текущая ёмкость, предельные мощности и рэмпы в различных состояниях) предлагается обновлять на основании истории работы в подсистеме цифровых двойников и сообщать об изменениях в широковещательном режиме для устранения ошибок в модели системы.

В итоге на данном этапе оптимальным путём видится перенос существующего централизованного решения вторым способом на децентрализованную систему, для чего должно быть достаточно договориться о протоколе обмена данными и провести техническую/программистскую работу по интеграции модуля управления в ПИВ и налаживания работы с ПЦД, параллельно занимаясь совершенствованием модели и разработкой более радикально децентрализованного решения на основе распределённых алгоритмов оптимизации, которое потом можно будет интегрировать, лишь немного изменив протокол обмена данными.


